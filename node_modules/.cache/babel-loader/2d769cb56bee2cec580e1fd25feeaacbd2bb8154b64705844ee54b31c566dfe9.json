{"ast":null,"code":"import VueApexCharts from 'vue-apexcharts';\nexport default {\n  name: 'ValChart',\n  components: {\n    apexchart: VueApexCharts\n  },\n  props: {\n    dataSource: {\n      type: Object,\n      required: true\n    }\n  },\n  data() {\n    return {\n      horizontalTotal: true // Убедимся, что total включён\n    };\n  },\n  computed: {\n    chartOptions() {\n      return {\n        chart: {\n          type: 'bar',\n          stacked: true,\n          toolbar: {\n            show: false\n          },\n          events: {\n            mounted: () => {\n              console.log('Chart mounted, customTotals:', this.dataSource.customTotals);\n            }\n          }\n        },\n        colors: this.dataSource.colors,\n        xaxis: {\n          categories: this.dataSource.categories,\n          labels: {\n            style: {\n              colors: '#ffffff',\n              fontSize: '12px',\n              fontFamily: 'Montserrat-Regular'\n            }\n          }\n        },\n        yaxis: {\n          labels: {\n            style: {\n              colors: '#ffffff',\n              fontSize: '12px',\n              fontFamily: 'Montserrat-Regular'\n            }\n          }\n        },\n        dataLabels: {\n          enabled: true,\n          offsetX: -6,\n          style: {\n            fontSize: '11px',\n            fontWeight: 400,\n            fontFamily: 'Montserrat-Regular',\n            colors: ['#ffffff']\n          },\n          formatter: val => val.toFixed(1),\n          total: {\n            enabled: this.horizontalTotal,\n            offsetX: 7,\n            // Для горизонтальной диаграммы смещаем по X\n            offsetY: 2,\n            style: {\n              fontSize: '14px',\n              fontWeight: 'normal',\n              fontFamily: 'Montserrat-Regular'\n            },\n            formatter: (val, opts) => {\n              // Индекс категории (учитываем порядок для горизонтальной диаграммы)\n              const index = opts.dataPointIndex; // Для horizontal: true порядок прямой\n              console.log(`Formatter called for index: ${index}, dataPointIndex: ${opts.dataPointIndex}`);\n              // Получаем данные из customTotals\n              const customTotals = opts.w.config.customTotals || [];\n              const [percent, total] = customTotals[index] || ['0%', 0];\n              console.log(`Category: ${opts.w.config.xaxis.categories[index]}, Percent: ${percent}, Total: ${total}`);\n              // Определяем цвет\n              const color = percent.startsWith('-') ? '#FF4D4F' : '#52C41A';\n              opts.w.config.dataLabels.total.style.colors = [color];\n              // Форматируем total\n              const formattedTotal = Number(total).toFixed(1);\n              // Пытаемся вернуть двухстрочный текст\n              return [percent, formattedTotal];\n            }\n          }\n        },\n        legend: {\n          labels: {\n            colors: '#ffffff',\n            fontFamily: 'Montserrat-Regular'\n          }\n        },\n        plotOptions: {\n          bar: {\n            horizontal: true,\n            barHeight: '70%'\n          }\n        }\n      };\n    }\n  }\n};","map":{"version":3,"names":["VueApexCharts","name","components","apexchart","props","dataSource","type","Object","required","data","horizontalTotal","computed","chartOptions","chart","stacked","toolbar","show","events","mounted","console","log","customTotals","colors","xaxis","categories","labels","style","fontSize","fontFamily","yaxis","dataLabels","enabled","offsetX","fontWeight","formatter","val","toFixed","total","offsetY","opts","index","dataPointIndex","w","config","percent","color","startsWith","formattedTotal","Number","legend","plotOptions","bar","horizontal","barHeight"],"sources":["src/components/ValChart.vue"],"sourcesContent":["```vue\r\n<template>\r\n  <div class=\"chart-wrapper\">\r\n    <apexchart\r\n      ref=\"chart\"\r\n      type=\"bar\"\r\n      height=\"100%\"\r\n      :options=\"chartOptions\"\r\n      :series=\"dataSource.series\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport VueApexCharts from 'vue-apexcharts';\r\n\r\nexport default {\r\n  name: 'ValChart',\r\n  components: {\r\n    apexchart: VueApexCharts,\r\n  },\r\n  props: {\r\n    dataSource: {\r\n      type: Object,\r\n      required: true,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      horizontalTotal: true, // Убедимся, что total включён\r\n    };\r\n  },\r\n  computed: {\r\n    chartOptions() {\r\n      return {\r\n        chart: {\r\n          type: 'bar',\r\n          stacked: true,\r\n          toolbar: { show: false },\r\n          events: {\r\n            mounted: () => {\r\n              console.log('Chart mounted, customTotals:', this.dataSource.customTotals);\r\n            },\r\n          },\r\n        },\r\n        colors: this.dataSource.colors,\r\n        xaxis: {\r\n          categories: this.dataSource.categories,\r\n          labels: {\r\n            style: {\r\n              colors: '#ffffff',\r\n              fontSize: '12px',\r\n              fontFamily: 'Montserrat-Regular',\r\n            },\r\n          },\r\n        },\r\n        yaxis: {\r\n          labels: {\r\n            style: {\r\n              colors: '#ffffff',\r\n              fontSize: '12px',\r\n              fontFamily: 'Montserrat-Regular',\r\n            },\r\n          },\r\n        },\r\n        dataLabels: {\r\n          enabled: true,\r\n          offsetX: -6,\r\n          style: {\r\n            fontSize: '11px',\r\n            fontWeight: 400,\r\n            fontFamily: 'Montserrat-Regular',\r\n            colors: ['#ffffff'],\r\n          },\r\n          formatter: (val) => val.toFixed(1),\r\n          total: {\r\n            enabled: this.horizontalTotal,\r\n            offsetX: 7, // Для горизонтальной диаграммы смещаем по X\r\n            offsetY: 2,\r\n            style: {\r\n              fontSize: '14px',\r\n              fontWeight: 'normal',\r\n              fontFamily: 'Montserrat-Regular',\r\n            },\r\n            formatter: (val, opts) => {\r\n              // Индекс категории (учитываем порядок для горизонтальной диаграммы)\r\n              const index = opts.dataPointIndex; // Для horizontal: true порядок прямой\r\n              console.log(`Formatter called for index: ${index}, dataPointIndex: ${opts.dataPointIndex}`);\r\n              // Получаем данные из customTotals\r\n              const customTotals = opts.w.config.customTotals || [];\r\n              const [percent, total] = customTotals[index] || ['0%', 0];\r\n              console.log(`Category: ${opts.w.config.xaxis.categories[index]}, Percent: ${percent}, Total: ${total}`);\r\n              // Определяем цвет\r\n              const color = percent.startsWith('-') ? '#FF4D4F' : '#52C41A';\r\n              opts.w.config.dataLabels.total.style.colors = [color];\r\n              // Форматируем total\r\n              const formattedTotal = Number(total).toFixed(1);\r\n              // Пытаемся вернуть двухстрочный текст\r\n              return [percent, formattedTotal];\r\n            },\r\n          },\r\n        },\r\n        legend: {\r\n          labels: {\r\n            colors: '#ffffff',\r\n            fontFamily: 'Montserrat-Regular',\r\n          },\r\n        },\r\n        plotOptions: {\r\n          bar: {\r\n            horizontal: true,\r\n            barHeight: '70%',\r\n          },\r\n        },\r\n      };\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.chart-wrapper {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.apexcharts-datalabel {\r\n  text-anchor: start !important;\r\n  dominant-baseline: hanging !important;\r\n}\r\n</style>"],"mappings":"AAcA,OAAAA,aAAA;AAEA;EACAC,IAAA;EACAC,UAAA;IACAC,SAAA,EAAAH;EACA;EACAI,KAAA;IACAC,UAAA;MACAC,IAAA,EAAAC,MAAA;MACAC,QAAA;IACA;EACA;EACAC,KAAA;IACA;MACAC,eAAA;IACA;EACA;EACAC,QAAA;IACAC,aAAA;MACA;QACAC,KAAA;UACAP,IAAA;UACAQ,OAAA;UACAC,OAAA;YAAAC,IAAA;UAAA;UACAC,MAAA;YACAC,OAAA,EAAAA,CAAA;cACAC,OAAA,CAAAC,GAAA,sCAAAf,UAAA,CAAAgB,YAAA;YACA;UACA;QACA;QACAC,MAAA,OAAAjB,UAAA,CAAAiB,MAAA;QACAC,KAAA;UACAC,UAAA,OAAAnB,UAAA,CAAAmB,UAAA;UACAC,MAAA;YACAC,KAAA;cACAJ,MAAA;cACAK,QAAA;cACAC,UAAA;YACA;UACA;QACA;QACAC,KAAA;UACAJ,MAAA;YACAC,KAAA;cACAJ,MAAA;cACAK,QAAA;cACAC,UAAA;YACA;UACA;QACA;QACAE,UAAA;UACAC,OAAA;UACAC,OAAA;UACAN,KAAA;YACAC,QAAA;YACAM,UAAA;YACAL,UAAA;YACAN,MAAA;UACA;UACAY,SAAA,EAAAC,GAAA,IAAAA,GAAA,CAAAC,OAAA;UACAC,KAAA;YACAN,OAAA,OAAArB,eAAA;YACAsB,OAAA;YAAA;YACAM,OAAA;YACAZ,KAAA;cACAC,QAAA;cACAM,UAAA;cACAL,UAAA;YACA;YACAM,SAAA,EAAAA,CAAAC,GAAA,EAAAI,IAAA;cACA;cACA,MAAAC,KAAA,GAAAD,IAAA,CAAAE,cAAA;cACAtB,OAAA,CAAAC,GAAA,gCAAAoB,KAAA,qBAAAD,IAAA,CAAAE,cAAA;cACA;cACA,MAAApB,YAAA,GAAAkB,IAAA,CAAAG,CAAA,CAAAC,MAAA,CAAAtB,YAAA;cACA,OAAAuB,OAAA,EAAAP,KAAA,IAAAhB,YAAA,CAAAmB,KAAA;cACArB,OAAA,CAAAC,GAAA,cAAAmB,IAAA,CAAAG,CAAA,CAAAC,MAAA,CAAApB,KAAA,CAAAC,UAAA,CAAAgB,KAAA,eAAAI,OAAA,YAAAP,KAAA;cACA;cACA,MAAAQ,KAAA,GAAAD,OAAA,CAAAE,UAAA;cACAP,IAAA,CAAAG,CAAA,CAAAC,MAAA,CAAAb,UAAA,CAAAO,KAAA,CAAAX,KAAA,CAAAJ,MAAA,IAAAuB,KAAA;cACA;cACA,MAAAE,cAAA,GAAAC,MAAA,CAAAX,KAAA,EAAAD,OAAA;cACA;cACA,QAAAQ,OAAA,EAAAG,cAAA;YACA;UACA;QACA;QACAE,MAAA;UACAxB,MAAA;YACAH,MAAA;YACAM,UAAA;UACA;QACA;QACAsB,WAAA;UACAC,GAAA;YACAC,UAAA;YACAC,SAAA;UACA;QACA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}