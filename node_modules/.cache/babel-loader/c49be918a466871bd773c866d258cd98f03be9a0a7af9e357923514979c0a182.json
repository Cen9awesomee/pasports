{"ast":null,"code":"import VueApexCharts from 'vue-apexcharts';\nexport default {\n  name: 'ValChart',\n  components: {\n    apexchart: VueApexCharts\n  },\n  props: {\n    dataSource: {\n      type: Object,\n      required: true\n    }\n  },\n  data() {\n    return {\n      horizontalTotal: true // Гарантируем, что total включён\n    };\n  },\n  computed: {\n    chartOptions() {\n      return {\n        chart: {\n          type: 'bar',\n          stacked: true,\n          toolbar: {\n            show: false\n          },\n          events: {\n            mounted: () => {\n              console.log('Chart mounted, customTotals:', this.dataSource.customTotals);\n            },\n            dataPointSelection: (event, chartContext, config) => {\n              console.log('Data point selected:', config);\n            }\n          }\n        },\n        colors: this.dataSource.colors,\n        xaxis: {\n          categories: this.dataSource.categories,\n          labels: {\n            style: {\n              colors: '#ffffff',\n              fontSize: '12px',\n              fontFamily: 'Montserrat-Regular'\n            }\n          }\n        },\n        yaxis: {\n          labels: {\n            style: {\n              colors: '#ffffff',\n              fontSize: '12px',\n              fontFamily: 'Montserrat-Regular'\n            }\n          }\n        },\n        dataLabels: {\n          enabled: true,\n          offsetX: -6,\n          style: {\n            fontSize: '11px',\n            fontWeight: 400,\n            fontFamily: 'Montserrat-Regular',\n            colors: ['#ffffff']\n          },\n          formatter: val => {\n            console.log('DataLabels formatter called, value:', val);\n            return val.toFixed(1);\n          },\n          total: {\n            enabled: this.horizontalTotal,\n            offsetX: 20,\n            // Увеличиваем смещение для видимости\n            offsetY: 0,\n            style: {\n              fontSize: '14px',\n              fontWeight: 'normal',\n              fontFamily: 'Montserrat-Regular'\n            },\n            formatter: (val, opts) => {\n              // Для horizontal: true используем прямой порядок\n              const index = opts.dataPointIndex;\n              console.log(`Total formatter called, index: ${index}, dataPointIndex: ${opts.dataPointIndex}, val: ${val}`);\n              const customTotals = opts.w.config.customTotals || [];\n              console.log('CustomTotals in formatter:', customTotals);\n              const [percent, total] = customTotals[index] || ['0%', 0];\n              console.log(`Category: ${opts.w.config.xaxis.categories[index]}, Percent: ${percent}, Total: ${total}`);\n              const color = percent.startsWith('-') ? '#FF4D4F' : '#52C41A';\n              opts.w.config.dataLabels.total.style.colors = [color];\n              const formattedTotal = Number(total).toFixed(1);\n              return [percent, formattedTotal];\n            }\n          }\n        },\n        legend: {\n          labels: {\n            colors: '#ffffff',\n            fontFamily: 'Montserrat-Regular'\n          }\n        },\n        plotOptions: {\n          bar: {\n            horizontal: true,\n            barHeight: '70%'\n          }\n        }\n      };\n    }\n  }\n};","map":{"version":3,"names":["VueApexCharts","name","components","apexchart","props","dataSource","type","Object","required","data","horizontalTotal","computed","chartOptions","chart","stacked","toolbar","show","events","mounted","console","log","customTotals","dataPointSelection","event","chartContext","config","colors","xaxis","categories","labels","style","fontSize","fontFamily","yaxis","dataLabels","enabled","offsetX","fontWeight","formatter","val","toFixed","total","offsetY","opts","index","dataPointIndex","w","percent","color","startsWith","formattedTotal","Number","legend","plotOptions","bar","horizontal","barHeight"],"sources":["src/components/ValChart.vue"],"sourcesContent":["```vue\r\n<template>\r\n  <div class=\"chart-wrapper\">\r\n    <apexchart\r\n      ref=\"chart\"\r\n      type=\"bar\"\r\n      height=\"100%\"\r\n      :options=\"chartOptions\"\r\n      :series=\"dataSource.series\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport VueApexCharts from 'vue-apexcharts';\r\n\r\nexport default {\r\n  name: 'ValChart',\r\n  components: {\r\n    apexchart: VueApexCharts,\r\n  },\r\n  props: {\r\n    dataSource: {\r\n      type: Object,\r\n      required: true,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      horizontalTotal: true, // Гарантируем, что total включён\r\n    };\r\n  },\r\n  computed: {\r\n    chartOptions() {\r\n      return {\r\n        chart: {\r\n          type: 'bar',\r\n          stacked: true,\r\n          toolbar: { show: false },\r\n          events: {\r\n            mounted: () => {\r\n              console.log('Chart mounted, customTotals:', this.dataSource.customTotals);\r\n            },\r\n            dataPointSelection: (event, chartContext, config) => {\r\n              console.log('Data point selected:', config);\r\n            },\r\n          },\r\n        },\r\n        colors: this.dataSource.colors,\r\n        xaxis: {\r\n          categories: this.dataSource.categories,\r\n          labels: {\r\n            style: {\r\n              colors: '#ffffff',\r\n              fontSize: '12px',\r\n              fontFamily: 'Montserrat-Regular',\r\n            },\r\n          },\r\n        },\r\n        yaxis: {\r\n          labels: {\r\n            style: {\r\n              colors: '#ffffff',\r\n              fontSize: '12px',\r\n              fontFamily: 'Montserrat-Regular',\r\n            },\r\n          },\r\n        },\r\n        dataLabels: {\r\n          enabled: true,\r\n          offsetX: -6,\r\n          style: {\r\n            fontSize: '11px',\r\n            fontWeight: 400,\r\n            fontFamily: 'Montserrat-Regular',\r\n            colors: ['#ffffff'],\r\n          },\r\n          formatter: (val) => {\r\n            console.log('DataLabels formatter called, value:', val);\r\n            return val.toFixed(1);\r\n          },\r\n          total: {\r\n            enabled: this.horizontalTotal,\r\n            offsetX: 20, // Увеличиваем смещение для видимости\r\n            offsetY: 0,\r\n            style: {\r\n              fontSize: '14px',\r\n              fontWeight: 'normal',\r\n              fontFamily: 'Montserrat-Regular',\r\n            },\r\n            formatter: (val, opts) => {\r\n              // Для horizontal: true используем прямой порядок\r\n              const index = opts.dataPointIndex;\r\n              console.log(`Total formatter called, index: ${index}, dataPointIndex: ${opts.dataPointIndex}, val: ${val}`);\r\n              const customTotals = opts.w.config.customTotals || [];\r\n              console.log('CustomTotals in formatter:', customTotals);\r\n              const [percent, total] = customTotals[index] || ['0%', 0];\r\n              console.log(`Category: ${opts.w.config.xaxis.categories[index]}, Percent: ${percent}, Total: ${total}`);\r\n              const color = percent.startsWith('-') ? '#FF4D4F' : '#52C41A';\r\n              opts.w.config.dataLabels.total.style.colors = [color];\r\n              const formattedTotal = Number(total).toFixed(1);\r\n              return [percent, formattedTotal];\r\n            },\r\n          },\r\n        },\r\n        legend: {\r\n          labels: {\r\n            colors: '#ffffff',\r\n            fontFamily: 'Montserrat-Regular',\r\n          },\r\n        },\r\n        plotOptions: {\r\n          bar: {\r\n            horizontal: true,\r\n            barHeight: '70%',\r\n          },\r\n        },\r\n      };\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.chart-wrapper {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.apexcharts-datalabels-group,\r\n.apexcharts-datalabel,\r\n.apexcharts-datalabel-value,\r\n.apexcharts-datalabel-label {\r\n  opacity: 1 !important;\r\n  visibility: visible !important;\r\n  display: block !important;\r\n  text-anchor: start !important;\r\n}\r\n</style>"],"mappings":"AAcA,OAAAA,aAAA;AAEA;EACAC,IAAA;EACAC,UAAA;IACAC,SAAA,EAAAH;EACA;EACAI,KAAA;IACAC,UAAA;MACAC,IAAA,EAAAC,MAAA;MACAC,QAAA;IACA;EACA;EACAC,KAAA;IACA;MACAC,eAAA;IACA;EACA;EACAC,QAAA;IACAC,aAAA;MACA;QACAC,KAAA;UACAP,IAAA;UACAQ,OAAA;UACAC,OAAA;YAAAC,IAAA;UAAA;UACAC,MAAA;YACAC,OAAA,EAAAA,CAAA;cACAC,OAAA,CAAAC,GAAA,sCAAAf,UAAA,CAAAgB,YAAA;YACA;YACAC,kBAAA,EAAAA,CAAAC,KAAA,EAAAC,YAAA,EAAAC,MAAA;cACAN,OAAA,CAAAC,GAAA,yBAAAK,MAAA;YACA;UACA;QACA;QACAC,MAAA,OAAArB,UAAA,CAAAqB,MAAA;QACAC,KAAA;UACAC,UAAA,OAAAvB,UAAA,CAAAuB,UAAA;UACAC,MAAA;YACAC,KAAA;cACAJ,MAAA;cACAK,QAAA;cACAC,UAAA;YACA;UACA;QACA;QACAC,KAAA;UACAJ,MAAA;YACAC,KAAA;cACAJ,MAAA;cACAK,QAAA;cACAC,UAAA;YACA;UACA;QACA;QACAE,UAAA;UACAC,OAAA;UACAC,OAAA;UACAN,KAAA;YACAC,QAAA;YACAM,UAAA;YACAL,UAAA;YACAN,MAAA;UACA;UACAY,SAAA,EAAAC,GAAA;YACApB,OAAA,CAAAC,GAAA,wCAAAmB,GAAA;YACA,OAAAA,GAAA,CAAAC,OAAA;UACA;UACAC,KAAA;YACAN,OAAA,OAAAzB,eAAA;YACA0B,OAAA;YAAA;YACAM,OAAA;YACAZ,KAAA;cACAC,QAAA;cACAM,UAAA;cACAL,UAAA;YACA;YACAM,SAAA,EAAAA,CAAAC,GAAA,EAAAI,IAAA;cACA;cACA,MAAAC,KAAA,GAAAD,IAAA,CAAAE,cAAA;cACA1B,OAAA,CAAAC,GAAA,mCAAAwB,KAAA,qBAAAD,IAAA,CAAAE,cAAA,UAAAN,GAAA;cACA,MAAAlB,YAAA,GAAAsB,IAAA,CAAAG,CAAA,CAAArB,MAAA,CAAAJ,YAAA;cACAF,OAAA,CAAAC,GAAA,+BAAAC,YAAA;cACA,OAAA0B,OAAA,EAAAN,KAAA,IAAApB,YAAA,CAAAuB,KAAA;cACAzB,OAAA,CAAAC,GAAA,cAAAuB,IAAA,CAAAG,CAAA,CAAArB,MAAA,CAAAE,KAAA,CAAAC,UAAA,CAAAgB,KAAA,eAAAG,OAAA,YAAAN,KAAA;cACA,MAAAO,KAAA,GAAAD,OAAA,CAAAE,UAAA;cACAN,IAAA,CAAAG,CAAA,CAAArB,MAAA,CAAAS,UAAA,CAAAO,KAAA,CAAAX,KAAA,CAAAJ,MAAA,IAAAsB,KAAA;cACA,MAAAE,cAAA,GAAAC,MAAA,CAAAV,KAAA,EAAAD,OAAA;cACA,QAAAO,OAAA,EAAAG,cAAA;YACA;UACA;QACA;QACAE,MAAA;UACAvB,MAAA;YACAH,MAAA;YACAM,UAAA;UACA;QACA;QACAqB,WAAA;UACAC,GAAA;YACAC,UAAA;YACAC,SAAA;UACA;QACA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}